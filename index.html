<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>JEWELS-AI | AR Luxury Experience</title>

  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    body { margin: 0; font-family: 'Poppins', sans-serif; background: #000; overflow: hidden; }

    /* --- LOADING OVERLAY --- */
    #custom-loader {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: #000; z-index: 9999; display: flex; flex-direction: column;
      align-items: center; justify-content: center; text-align: center;
    }
    .loader-spinner {
      border: 4px solid #333; border-top: 4px solid #d4af37; border-radius: 50%;
      width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 20px;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* --- UI ELEMENTS --- */
    #ticker-bar {
      position: absolute; top: 0; left: 0; width: 100%; height: 30px;
      background: #1a1a1a; color: #d4af37; z-index: 500;
      display: flex; align-items: center; overflow: hidden;
      border-bottom: 1px solid #d4af37;
    }
    .ticker-content {
      white-space: nowrap; animation: ticker 15s linear infinite; font-size: 12px; font-weight: 600; padding-left: 100%;
    }
    @keyframes ticker { 0% { transform: translateX(0); } 100% { transform: translateX(-200%); } }

    #logo { position: absolute; top: 50px; left: 16px; width: 80px; z-index: 100; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5)); }

    /* --- CONTROLS --- */
    #ar-controls {
      position: absolute; bottom: 0; left: 0; width: 100%;
      background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
      padding: 20px 10px; z-index: 400; display: none;
      flex-direction: column; gap: 10px; align-items: center;
    }

    /* Buttons */
    .action-grid { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; }
    .lux-btn {
      padding: 8px 12px; font-size: 11px; font-weight: bold; border: 1px solid rgba(255,255,255,0.3);
      border-radius: 20px; background: rgba(0,0,0,0.6); color: #fff; cursor: pointer;
      display: flex; align-items: center; gap: 5px; transition: 0.3s;
    }
    .lux-btn:hover { background: #d4af37; color: #000; border-color: #d4af37; }
    .lux-btn.primary { background: #d4af37; color: #000; }

    /* Engraving Box */
    .engrave-box {
      display: flex; gap: 5px; background: rgba(255,255,255,0.1); padding: 8px; rounded: 8px; backdrop-filter: blur(5px);
    }
    .engrave-input {
      background: transparent; border: none; border-bottom: 1px solid #fff; color: #fff;
      font-family: 'Playfair Display', serif; width: 150px; text-align: center;
    }
    .engrave-input:focus { outline: none; border-bottom: 1px solid #d4af37; }

    /* --- OVERLAYS --- */
    #ring-sizer-overlay {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.9); z-index: 600; display: none;
      flex-direction: column; align-items: center; justify-content: center; color: white;
    }
    .sizer-circle {
      width: 200px; height: 200px; border: 4px solid #d4af37; border-radius: 50%;
      box-shadow: 0 0 20px rgba(212, 175, 55, 0.5); transition: 0.1s;
    }

    .modal {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      width: 85%; max-width: 350px; background: white; border-radius: 12px;
      z-index: 700; padding: 20px; text-align: center; display: none; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
    .close-modal { margin-top: 15px; color: #888; text-decoration: underline; cursor: pointer; font-size: 12px; }

    #toast {
      position: absolute; top: 80px; right: 20px; background: rgba(94, 15, 139, 0.9);
      color: white; padding: 8px 12px; border-radius: 8px; z-index: 800; display: none; font-size: 12px;
    }
  </style>
</head>
<body>

  <div id="custom-loader">
    <div class="loader-spinner"></div>
    <p style="color: #d4af37; font-size: 14px; letter-spacing: 1px;">INITIALIZING LUXURY AR...</p>
    <p style="color: #888; font-size: 10px; margin-top: 5px;">Please Allow Camera Access</p>
  </div>

  <div id="ticker-bar">
    <div class="ticker-content" id="goldRateTicker">Loading Market Rates...</div>
  </div>

  <img src="logo.png" id="logo" alt="JEWELS-AI" onerror="this.style.display='none'">

  <div id="ring-sizer-overlay">
    <h3 style="font-family: 'Playfair Display'; margin-bottom: 20px;">Align ring with circle</h3>
    <div class="sizer-circle" id="sizerCircle"></div>
    <input type="range" min="150" max="300" value="200" id="sizerRange" style="width: 80%; margin-top: 30px;">
    <p id="sizerValue">Size: US 7</p>
    <button class="lux-btn" onclick="toggleSizer(false)">Done</button>
  </div>

  <div id="clarityModal" class="modal">
    <h3 style="font-family: 'Playfair Display'">Diamond Clarity</h3>
    <div style="height: 120px; background: #eee; display: flex; align-items: center; justify-content: center; margin: 10px 0; border: 1px solid #ddd;">
       <div style="width: 50%; border-right: 1px solid #aaa;">VVS1</div>
       <div style="width: 50%;">SI2</div>
    </div>
    <p style="font-size: 11px; color: #666;">Zoom to see inclusion differences.</p>
    <div class="close-modal" onclick="document.getElementById('clarityModal').style.display='none'">Close</div>
  </div>

  <div id="certModal" class="modal">
    <h3 style="color: #d4af37; font-family: 'Playfair Display'">Authenticity Verified</h3>
    <p style="font-size: 12px; font-weight: bold;">BIS Hallmark | GIA Certified</p>
    <div style="background: #f9f9f9; padding: 15px; margin: 15px 0; border: 1px dashed #d4af37; font-family: monospace;">ID: #998-XX-JWL</div>
    <div class="close-modal" onclick="document.getElementById('certModal').style.display='none'">Close</div>
  </div>

  <div id="ar-controls" aria-hidden="true">
    <div class="engrave-box">
      <span style="color: #d4af37; font-size: 12px;">‚úé</span>
      <input type="text" class="engrave-input" id="engravingInput" placeholder="Engrave Name..." maxlength="10">
    </div>

    <div class="action-grid">
      <button class="lux-btn primary" id="toggleButton">‚ñ∂Ô∏è Video</button>
      <button class="lux-btn" onclick="toggleSizer(true)">üìè Sizer</button>
      <button class="lux-btn" onclick="showToast('Starting Front Camera...', 2000)">üì∏ Try-On</button>
      <button class="lux-btn" onclick="dropHint()">üòâ Hint</button>
      <button class="lux-btn" onclick="document.getElementById('clarityModal').style.display='block'">üíé Clarity</button>
      <button class="lux-btn" onclick="document.getElementById('certModal').style.display='block'">üìú Cert</button>
    </div>
  </div>

  <div id="toast" role="status">Action Disabled</div>

  <a-scene 
    mindar-image="imageTargetSrc: https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/examples/image-tracking/assets/card-example/card.mind; uiLoading: no;" 
    color-space="sRGB" 
    renderer="colorManagement: true; physicallyCorrectLights: true; antialias: true" 
    vr-mode-ui="enabled: false" 
    device-orientation-permission-ui="enabled: false">

    <a-assets>
      <video id="plan1Video" src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/examples/image-tracking/assets/card-example/portfolio/portfolio.mp4" playsinline preload="auto" loop crossorigin="anonymous"></video>
      
      <a-asset-item id="ringModel" src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/examples/image-tracking/assets/band-example/raccoon/scene.gltf"></a-asset-item>
    </a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <a-entity id="target1" mindar-image-target="targetIndex: 0">
      
      <a-plane 
        id="videoDisplay" position="0 0 0" width="1" height="0.55" 
        material="src: #plan1Video; shader: flat; side: double" class="clickable">
      </a-plane>

      <a-entity position="0 0.1 0.2" rotation="0 0 0" scale="0.05 0.05 0.05" 
        animation="property: rotation; to: 0 360 0; loop: true; dur: 8000; easing: linear">
        <a-gltf-model src="#ringModel"></a-gltf-model>
        
        <a-text id="arEngraving" value="" color="#d4af37" position="0 2 0" align="center" width="20" side="double"></a-text>
      </a-entity>

    </a-entity>
  </a-scene>

  <script>
    const sceneEl = document.querySelector('a-scene');
    const loader = document.getElementById('custom-loader');
    
    // --- HIDE LOADING SCREEN WHEN CAMERA STARTS ---
    sceneEl.addEventListener('arReady', () => {
      console.log("AR Ready");
      loader.style.display = 'none';
    });

    sceneEl.addEventListener('arError', (e) => {
      console.log("AR Error", e);
      loader.innerHTML = "<p style='color:red'>CAMERA ERROR<br>Please allow permissions</p>";
    });

    // --- VARIABLES ---
    const videoEl = document.querySelector('#plan1Video');
    const toggleButton = document.querySelector('#toggleButton');
    const target = document.querySelector('#target1');
    const controls = document.querySelector('#ar-controls');
    let isPlaying = false;

    // 1. LIVE GOLD RATE
    function updateTicker() {
      document.getElementById('goldRateTicker').innerHTML = 
        `LIVE RATES: GOLD 24K: ‚Çπ7,250/gm  ‚Ä¢  GOLD 22K: ‚Çπ6,850/gm  ‚Ä¢  SILVER: ‚Çπ88.50/gm  ‚Ä¢  PLATINUM: ‚Çπ3,200/gm`;
    }
    updateTicker();

    // 9. ENGRAVING LOGIC
    document.getElementById('engravingInput').addEventListener('input', function(e) {
      document.getElementById('arEngraving').setAttribute('value', e.target.value);
    });

    // 5. RING SIZER
    const sizerOverlay = document.getElementById('ring-sizer-overlay');
    const sizerRange = document.getElementById('sizerRange');
    const sizerCircle = document.getElementById('sizerCircle');
    const sizerValue = document.getElementById('sizerValue');

    window.toggleSizer = function(show) { sizerOverlay.style.display = show ? 'flex' : 'none'; };
    sizerRange.addEventListener('input', (e) => {
      const val = e.target.value;
      sizerCircle.style.width = val + 'px'; sizerCircle.style.height = val + 'px';
      const size = Math.floor((val - 150) / 10) + 4;
      sizerValue.innerText = `Approx Size: US ${size}`;
    });

    // 6. DROP A HINT
    window.dropHint = function() {
      window.location.href = `https://wa.me/?text=${encodeURIComponent("Check out this ring on Jewels-AI!")}`;
    };

    // --- MINDAR LOGIC ---
    target.addEventListener('targetFound', () => {
      controls.style.display = 'flex';
      // Auto-play video on find (optional)
      // videoEl.play();
    });

    target.addEventListener('targetLost', () => {
      controls.style.display = 'none';
      videoEl.pause();
      isPlaying = false;
      toggleButton.innerHTML = "‚ñ∂Ô∏è Video";
    });

    toggleButton.addEventListener('click', () => {
      if (!isPlaying) {
        videoEl.play();
        isPlaying = true;
        toggleButton.innerHTML = "‚è∏ Pause";
      } else {
        videoEl.pause();
        isPlaying = false;
        toggleButton.innerHTML = "‚ñ∂Ô∏è Video";
      }
    });

    function showToast(msg, t = 1200) {
      const toast = document.getElementById('toast');
      toast.textContent = msg; toast.style.display = 'block';
      setTimeout(() => { toast.style.display = 'none'; }, t);
    }
  </script>
</body>
</html>